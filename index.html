<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Equipment Issue Tracker</title>
  <style>
    /* --- CSS Styles for layout and design --- */
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    h1 {
      text-align: center;
    }
    .container {
      display: flex;
      justify-content: space-between;
    }
    .main-content {
      flex: 3;
      min-width: 0;
    }
    .sidebar {
      flex: 1;
      margin-left: 20px;
    }
    /* Table styling */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }
    th {
      background: #f0f0f0;
    }
    input[type="text"] {
      width: 100%;
      box-sizing: border-box;
      padding: 4px;
    }
    /* Buttons and indicator */
    button {
      margin: 2px;
    }
    .statusIndicator {
      display: inline-block;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: red;           /* default red (Not Issued) */
      vertical-align: middle;
      margin-left: 8px;
    }
    .statusIndicator.green { background: green; }
    .statusIndicator.red   { background: red; }
    /* Sidebar styling */
    .sidebar h3 {
      margin-top: 0;
    }
    .sidebar p.legend {
      font-size: 0.9em;
      margin: 5px 0;
    }
    .sidebar ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    .sidebar li {
      margin: 2px 0;
      font-weight: bold;
    }
    .sidebar li.empty {
      font-weight: normal;
      font-style: italic;
      color: #555;
    }
    .sidebar li.not-issued { color: green; }
    .sidebar li.issued    { color: red; }
    /* Signature modal styling */
    .modal {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
    }
    .modal.open {
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .modal-content {
      background: #fff;
      padding: 20px;
      border-radius: 5px;
      text-align: center;
      max-width: 90%;
    }
    #signatureCanvas {
      border: 1px solid #ccc;
      width: 100%;
      max-width: 400px;
      height: 200px;
      touch-action: none; /* prevent touch gestures like scrolling while drawing */
    }
    /* Responsive: stack sidebar below on narrow screens */
    @media (max-width: 600px) {
      .container {
        flex-direction: column;
      }
      .sidebar {
        margin-left: 0;
        margin-top: 20px;
      }
    }
  </style>
</head>
<body>

  <h1>Equipment Issue Tracker</h1>
  <div class="container">
    <!-- Main content: Table and Add Row button -->
    <div class="main-content">
      <button id="addRowBtn">Add Row</button>
      <table id="equipmentTable">
        <thead>
          <tr>
            <th>#</th>
            <th>Name</th>
            <th>MCN Set #1</th>
            <th>MCN Set #2</th>
            <th>Battery #1</th>
            <th>Battery #2</th>
            <th>Status</th>
            <th>Signature</th>
          </tr>
        </thead>
        <tbody id="tableBody">
          <!-- Rows will be generated by JavaScript -->
        </tbody>
      </table>
    </div>

    <!-- Sidebar: Unique MCN list with status colors -->
    <div class="sidebar">
      <h3>MCN Status Summary</h3>
      <p class="legend">
        <span style="color:green">&#9679;</span> Not Issued &nbsp; 
        <span style="color:red">&#9679;</span> Issued
      </p>
      <ul id="mcnSidebarList">
        <li class="empty">No MCNs listed yet</li>
      </ul>
    </div>
  </div>

  <!-- Datalists for auto-suggestions (can be populated with real data) -->
 <datalist id="mcnSuggestions">
  <option value="2243001"></option><option value="2243002"></option><option value="2243003"></option><option value="2243004"></option>
  <option value="2243005"></option><option value="2243006"></option><option value="2243007"></option><option value="2243008"></option>
  <option value="2243009"></option><option value="2243010"></option><option value="2243011"></option><option value="2243012"></option>
  <option value="2243013"></option><option value="2243014"></option><option value="2243015"></option><option value="2243016"></option>
  <option value="2243017"></option><option value="2243018"></option><option value="2243019"></option><option value="2243020"></option>
  <option value="2243021"></option><option value="2243022"></option><option value="2243023"></option><option value="2243024"></option>
  <option value="2243025"></option><option value="2243026"></option><option value="2243027"></option><option value="2243028"></option>
  <option value="2243029"></option><option value="2243030"></option><option value="2243031"></option><option value="2243032"></option>
  <option value="2243033"></option><option value="2243034"></option><option value="2243035"></option><option value="2243036"></option>
  <option value="2243037"></option><option value="2243038"></option><option value="2243039"></option><option value="2243040"></option>
  <option value="2243041"></option><option value="2243042"></option><option value="2243043"></option><option value="2243044"></option>
  <option value="2243045"></option><option value="2243046"></option><option value="2243047"></option><option value="2243048"></option>
  <option value="2243049"></option><option value="2243050"></option><option value="2243051"></option><option value="2243052"></option>
</datalist>

  <datalist id="batterySuggestions">
    <option value="BAT-001"></option>
    <option value="BAT-002"></option>
    <option value="BAT-003"></option>
    <option value="BAT-004"></option>
    <option value="BAT-005"></option>
  </datalist>

  <!-- Signature Pad Modal -->
  <div id="signatureModal" class="modal">
    <div class="modal-content">
      <h3>Sign (use mouse or touch)</h3>
      <canvas id="signatureCanvas" width="400" height="200"></canvas>
      <div>
        <button id="clearSignature">Clear</button>
        <button id="saveSignature">Save</button>
        <button id="closeModal">Cancel</button>
      </div>
    </div>
  </div>

  <script>
    // --- JavaScript for dynamic functionality ---
    const tableBody        = document.getElementById('tableBody');
    const addRowBtn        = document.getElementById('addRowBtn');
    const mcnSidebarList   = document.getElementById('mcnSidebarList');
    const signatureModal   = document.getElementById('signatureModal');
    const signatureCanvas  = document.getElementById('signatureCanvas');
    const clearSigBtn      = document.getElementById('clearSignature');
    const saveSigBtn       = document.getElementById('saveSignature');
    const closeModalBtn    = document.getElementById('closeModal');
    let currentSignRow = null;  // will hold the current row element for which signature is being taken

    //full mcn list 
    const fullMCNList = [
  "2243001","2243002","2243003","2243004","2243005","2243006","2243007","2243008","2243009","2243010",
  "2243011","2243012","2243013","2243014","2243015","2243016","2243017","2243018","2243019","2243020",
  "2243021","2243022","2243023","2243024","2243025","2243026","2243027","2243028","2243029","2243030",
  "2243031","2243032","2243033","2243034","2243035","2243036","2243037","2243038","2243039","2243040",
  "2243041","2243042","2243043","2243044","2243045","2243046","2243047","2243048","2243049","2243050",
  "2243051","2243052"
];

    // Canvas context for signature drawing
    const ctx = signatureCanvas.getContext('2d');
    ctx.strokeStyle = "#000";
    ctx.lineWidth = 2;
    ctx.lineCap = "round";
    ctx.lineJoin = "round";
    let drawing = false;

    // Mouse events for drawing on canvas
    signatureCanvas.addEventListener('mousedown', (e) => {
      drawing = true;
      ctx.beginPath();
      const rect = signatureCanvas.getBoundingClientRect();
      ctx.moveTo(e.clientX - rect.left, e.clientY - rect.top);
    });
    signatureCanvas.addEventListener('mousemove', (e) => {
      if (!drawing) return;
      const rect = signatureCanvas.getBoundingClientRect();
      ctx.lineTo(e.clientX - rect.left, e.clientY - rect.top);
      ctx.stroke();
    });
    signatureCanvas.addEventListener('mouseup', () => {
      drawing = false;
    });
    signatureCanvas.addEventListener('mouseout', () => {
      drawing = false;
    });
    // Touch events for drawing on canvas (for mobile devices)
    signatureCanvas.addEventListener('touchstart', (e) => {
      e.preventDefault();
      drawing = true;
      ctx.beginPath();
      const rect = signatureCanvas.getBoundingClientRect();
      ctx.moveTo(e.touches[0].clientX - rect.left, e.touches[0].clientY - rect.top);
    });
    signatureCanvas.addEventListener('touchmove', (e) => {
      e.preventDefault();
      if (!drawing) return;
      const rect = signatureCanvas.getBoundingClientRect();
      ctx.lineTo(e.touches[0].clientX - rect.left, e.touches[0].clientY - rect.top);
      ctx.stroke();
    });
    signatureCanvas.addEventListener('touchend', (e) => {
      e.preventDefault();
      drawing = false;
    });

    // Function to update the MCN sidebar list based on table data
    function updateSidebar() {
  mcnSidebarList.innerHTML = "";

  fullMCNList.forEach(mcn => {
    let isIssued = false;
    const rows = tableBody.querySelectorAll('tr');
    
    rows.forEach(row => {
      const mcnInputs = row.querySelectorAll('.mcnInput');
      const statusIndicator = row.querySelector('.statusIndicator');

      mcnInputs.forEach(input => {
        if (input.value.trim() === mcn && statusIndicator.classList.contains('green')) {
          isIssued = true;
        }
      });
    });

    const li = document.createElement('li');
    li.textContent = mcn;
    li.className = isIssued ? "issued" : "not-issued";
    mcnSidebarList.appendChild(li);
  });
}

      // Build list items with color indicating status
      uniqueMCNs.forEach(mcn => {
        // Determine if this MCN has been issued (appears in any row marked issued)
        let isIssued = false;
        const rows = tableBody.querySelectorAll('tr');
        rows.forEach(row => {
          const mcnFields = row.querySelectorAll('.mcnInput');
          if (mcnFields.length) {
            const [m1, m2] = mcnFields;
            if (m1.value.trim() === mcn || m2.value.trim() === mcn) {
              const indicator = row.querySelector('.statusIndicator');
              if (indicator && indicator.classList.contains('green')) {
                isIssued = true;
              }
            }
          }
        });
        // Create list item for this MCN with appropriate color class
        const li = document.createElement('li');
        li.textContent = mcn;
        li.className = isIssued ? "issued" : "not-issued";
        mcnSidebarList.appendChild(li);
      });
    }

    // Function to create a new table row with the required structure and events
    function addRow(index) {
      const rowIndex = index || tableBody.rows.length + 1;  // if index not provided, use next number
      const tr = document.createElement('tr');
      // Column 1: Row number
      const tdNum = document.createElement('td');
      tdNum.textContent = rowIndex;
      tr.appendChild(tdNum);
      // Column 2: Name input
      const tdName = document.createElement('td');
      const nameInput = document.createElement('input');
      nameInput.type = "text";
      nameInput.placeholder = "Name";
      nameInput.className = "nameInput";
      tdName.appendChild(nameInput);
      tr.appendChild(tdName);
      // Column 3: MCN Set Number 1 (with suggestions)
      const tdMcn1 = document.createElement('td');
      const mcnInput1 = document.createElement('input');
      mcnInput1.type = "text";
      mcnInput1.placeholder = "MCN Set #1";
      mcnInput1.setAttribute('list', 'mcnSuggestions');
      mcnInput1.className = "mcnInput";
      tdMcn1.appendChild(mcnInput1);
      tr.appendChild(tdMcn1);
      // Column 4: MCN Set Number 2 (with suggestions)
      const tdMcn2 = document.createElement('td');
      const mcnInput2 = document.createElement('input');
      mcnInput2.type = "text";
      mcnInput2.placeholder = "MCN Set #2";
      mcnInput2.setAttribute('list', 'mcnSuggestions');
      mcnInput2.className = "mcnInput";
      tdMcn2.appendChild(mcnInput2);
      tr.appendChild(tdMcn2);
      // Column 5: Battery Number 1 (with suggestions)
      const tdBat1 = document.createElement('td');
      const batInput1 = document.createElement('input');
      batInput1.type = "text";
      batInput1.placeholder = "Battery #1";
      batInput1.setAttribute('list', 'batterySuggestions');
      tdBat1.appendChild(batInput1);
      tr.appendChild(tdBat1);
      // Column 6: Battery Number 2 (with suggestions)
      const tdBat2 = document.createElement('td');
      const batInput2 = document.createElement('input');
      batInput2.type = "text";
      batInput2.placeholder = "Battery #2";
      batInput2.setAttribute('list', 'batterySuggestions');
      tdBat2.appendChild(batInput2);
      tr.appendChild(tdBat2);
      // Column 7: Issued / Not Issued Yet buttons + indicator
      const tdStatus = document.createElement('td');
      const issueBtn = document.createElement('button');
      issueBtn.textContent = "Issued";
      issueBtn.className = "issuedBtn";
      const notIssueBtn = document.createElement('button');
      notIssueBtn.textContent = "Not Issued Yet";
      notIssueBtn.className = "notIssuedBtn";
      const indicator = document.createElement('span');
      indicator.className = "statusIndicator red";  // default: not issued (red dot)
      indicator.title = "Not Issued";
      tdStatus.appendChild(issueBtn);
      tdStatus.appendChild(notIssueBtn);
      tdStatus.appendChild(indicator);
      tr.appendChild(tdStatus);
      // Column 8: Sign button
      const tdSign = document.createElement('td');
      const signBtn = document.createElement('button');
      signBtn.textContent = "Sign";
      signBtn.className = "signBtn";
      tdSign.appendChild(signBtn);
      tr.appendChild(tdSign);
      // Append the new row to the table body
      tableBody.appendChild(tr);
      // Event listeners for the new row's interactive elements:
      issueBtn.addEventListener('click', () => {
        // Mark as Issued (green indicator)
        indicator.classList.remove('red');
        indicator.classList.add('green');
        indicator.title = "Issued";
        updateSidebar();
      });
      notIssueBtn.addEventListener('click', () => {
        // Mark as Not Issued (red indicator)
        indicator.classList.remove('green');
        indicator.classList.add('red');
        indicator.title = "Not Issued";
        updateSidebar();
      });
      // Update sidebar whenever MCN fields change (on blur or change)
      mcnInput1.addEventListener('change', updateSidebar);
      mcnInput2.addEventListener('change', updateSidebar);
      mcnInput1.addEventListener('blur', updateSidebar);
      mcnInput2.addEventListener('blur', updateSidebar);
      // Open signature modal on Sign button click
      signBtn.addEventListener('click', () => {
        currentSignRow = tr;
        signatureModal.classList.add('open');
        // Clear any previous drawing
        ctx.clearRect(0, 0, signatureCanvas.width, signatureCanvas.height);
      });
    }

    // Initialize table with 49 rows
    for (let i = 1; i <= 49; i++) {
      addRow(i);
    }

    // Handle Add Row button to append a new row
    addRowBtn.addEventListener('click', () => {
      addRow(); // will use next sequential number automatically
      // (Optionally, scroll the table to the bottom to show the new row)
      tableBody.lastElementChild.scrollIntoView({ behavior: 'smooth' });
    });

    const nameList = [
  "LONG JIEH LIANG",
  "MUHAMAD RIZAL BIN RIDWAN",
  "RAYMOND NG TECK MIN",
  "NOOR HALEEM BIN MOHD HANIFA",
  "ERIK LOI ENG HAU",
  "MUHAMMAD AMLI BIN MOHAMAD ALI",
  "AHMAD ANAS BIN MOHD MOHAIYUDDIN",
  "CLARENCE CHIEW WEI CHONG",
  "MUHAMMAD RIZUAN BIN MOHIDIN",
  "MUHAMMAD KHAIRUL ANUAR BIN ABDUL RAHMAN",
  "CHAI WEE YEONG",
  "MUHAMMAD SYAFIQ BIN SULAIMAN",
  "LIM JIAN DA",
  "MUHAMMAD LUQMAN NUL HAKIM",
  "MARCUS WONG LIANG WEI",
  "MUHAMMAD SHAZWANDI BIN SURIMAN",
  "ABDULLAH KHAN BIN MOHAMED MURTUJAH",
  "MUHAMMAD HAIKAL BIN RAMLAN",
  "MOHAMAD SOLIHIN BIN MOHAMAD YUSRI",
  "MUHAMMAD HAZIQ BIN JASMAN",
  "MUHAMMAD NURHADI BIN RAMLEE",
  "MOHAMAD ILYAS BIN MOHAMAD ZAIDI",
  "SNG XIANG MING",
  "NG JIA SHENG",
  "ARIF ABDULLAH BIN ROSLAN",
  "LIM WEI LIANG",
  "R THAMIL MAGAN",
  "MUHAMMAD ADLIFIKRI BIN ADANAN",
  "MOHAMMAD DANIAL BIN NOORALAM",
  "LEE YI XIANG",
  "SIM JUN TING",
  "MUHAMMAD SYAFIYUDDIN BIN YUSRAN",
  "MOHAMMAD ARIFIN BIN MOHAMED SALLEH",
  "ADIB AFHAN BIN MOHAMAD SUHAIMI",
  "MOHAMED HAFIS MARICAN BIN ASANA MARICAN",
  "MOHAMAD ILHAM ZIKRY BIN MOHAMAD",
  "MUHAMMED SHAFIQ BIN NAINAM",
  "GOH ZHI PENG",
  "HO SZE HAN AARON",
  "GAN JIAN WEI",
  "MUHAMMAD AQASHA BIN SYED THAHAR",
  "MUHAMMAD SYAFIQ BIN RUDYWAN",
  "MUHAMMAD AQASYA BIN YUSNIZAM",
  "ZIKRI IEZZAT BIN ZAKIR MOHAMMED",
  "DANIEL IZZAT ROSLEE",
  "MUHAMMAD ZAIYANI HIDIR BIN ZAINAL",
  "DAIYAN BIN EDDIE",
  "JUSTUS HUAN REN JIE",
  "DAYAN TAN JIE AN"
];

// Initialize table with pre-filled names
nameList.forEach((name, index) => {
  addRow(index + 1); // Create row
  const row = tableBody.lastElementChild;
  const nameInput = row.querySelector('.nameInput');
  nameInput.value = name;
});


    // Save signature: save to localStorage and trigger download
    saveSigBtn.addEventListener('click', () => {
      if (!currentSignRow) return;
      // Get name for filename
      let nameVal = currentSignRow.querySelector('.nameInput').value.trim();
      if (nameVal === "") nameVal = "untitled";
      const fileName = nameVal.replace(/\s+/g, "_") + "_signature.png";
      // Get image data from canvas
      const dataURL = signatureCanvas.toDataURL("image/png");
      // Store in localStorage (optional for future use)
      try {
        localStorage.setItem("signature_" + nameVal, dataURL);
      } catch (e) {
        console.warn("Could not save signature to localStorage (maybe storage full)");
      }
      // Create a download link and click it
      const link = document.createElement('a');
      link.href = dataURL;
      link.download = fileName;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      // Close the modal
      signatureModal.classList.remove('open');
    });
    // Clear the signature canvas
    clearSigBtn.addEventListener('click', () => {
      ctx.clearRect(0, 0, signatureCanvas.width, signatureCanvas.height);
    });
    // Cancel/close the signature modal
    closeModalBtn.addEventListener('click', () => {
      signatureModal.classList.remove('open');
    });
  </script>

</body>
</html>
